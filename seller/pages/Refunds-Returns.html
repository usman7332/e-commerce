<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Refunds & Returns - Seller Dashboard</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
    }
    .main-content {
      padding: 20px;
      margin-top: 20px;
    }

    .main-content h1 {
      color: #232f3e;
      margin-bottom: 20px;
      font-size: 24px;
    }

    /* ===== SUMMARY CARDS ===== */
    .summary-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 40px;
    }

    .summary-card {
      flex: 1 1 200px;
      background: white;
      padding: 20px;
      border-radius: 10px;
      border-left: 5px solid;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .summary-card:hover {
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      transform: translateY(-4px);
    }

    .summary-card p {
      opacity: 0.6;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .summary-value {
      font-size: 24px;
      font-weight: 700;
      color: #232f3e;
    }

    /* ===== SECTION HEADER ===== */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: #232f3e;
    }

    .search-filter {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .search-bar {
      position: relative;
      flex: 1;
      min-width: 200px;
    }

    .search-bar input {
      width: 100%;
      padding: 10px 15px 10px 40px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 13px;
    }

    .search-bar input:focus {
      outline: none;
      border-color: #232f3e;
      box-shadow: 0 0 0 3px rgba(35, 47, 62, 0.1);
    }

    .search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #666;
      font-size: 18px;
      pointer-events: none;
    }

    .filter-select {
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 13px;
      background-color: white;
      cursor: pointer;
      min-width: 140px;
    }

    .filter-select:focus {
      outline: none;
      border-color: #232f3e;
    }

    /* ===== RETURNS TABLE ===== */
    .returns-section {
      background-color: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 40px;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    .data-table thead tr {
      border-bottom: 2px solid #ddd;
      background-color: #f5f5f5;
    }

    .data-table th {
      padding: 15px;
      text-align: left;
      font-weight: 600;
      color: #232f3e;
      font-size: 13px;
      text-transform: uppercase;
    }

    .data-table tbody tr {
      border-bottom: 1px solid #ddd;
      transition: background-color 0.2s;
    }

    .data-table tbody tr:hover {
      background-color: #f5f5f5;
    }

    .data-table td {
      padding: 15px;
      font-size: 13px;
    }

    .return-id {
      font-weight: 600;
      color: #232f3e;
    }

    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .badge-pending {
      background-color: #fef3cd;
      color: #856404;
    }

    .badge-approved {
      background-color: #d4edda;
      color: #155724;
    }

    .badge-rejected {
      background-color: #f8d7da;
      color: #721c24;
    }

    .badge-completed {
      background-color: #d1ecf1;
      color: #0c5460;
    }

    .action-buttons {
      display: flex;
      gap: 8px;
    }

    .btn-view, .btn-approve, .btn-reject {
      background: none;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 600;
      transition: all 0.2s;
    }

    .btn-view {
      color: #0066c0;
    }

    .btn-view:hover {
      background-color: #e7f3ff;
      color: #232f3e;
    }

    .btn-approve {
      color: #155724;
      background-color: #d4edda;
    }

    .btn-approve:hover {
      background-color: #c3e6cb;
    }

    .btn-reject {
      color: #721c24;
      background-color: #f8d7da;
    }

    .btn-reject:hover {
      background-color: #f5c6cb;
    }

    /* ===== PAGINATION ===== */
    .pagination {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 20px;
    }

    .pagination button {
      padding: 8px 12px;
      border: 1px solid #ddd;
      background-color: white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    .pagination button:hover {
      background-color: #f5f5f5;
      border-color: #232f3e;
    }

    .pagination button.active {
      background-color: #232f3e;
      color: white;
      border-color: #232f3e;
    }

    .pagination button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* ===== MODAL ===== */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background-color: white;
      border-radius: 10px;
      max-width: 1000px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    }

    .modal-header {
      padding: 20px;
      background-color: #232f3e;
      color: white;
      border-radius: 10px 10px 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 20px;
    }

    .modal-close {
      background: none;
      border: none;
      color: white;
      font-size: 28px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
    }

    .modal-body {
      padding: 30px;
    }

    /* ===== DETAIL GRID ===== */
    .detail-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    .detail-section {
      background-color: #f9fafb;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
    }

    .detail-section h3 {
      margin: 0 0 15px 0;
      color: #232f3e;
      font-size: 16px;
      font-weight: 600;
    }

    .detail-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      font-size: 14px;
    }

    .detail-item label {
      color: #666;
      font-weight: 600;
    }

    .detail-item value {
      color: #333;
      text-align: right;
    }

    /* ===== TIMELINE ===== */
    .timeline {
      background: linear-gradient(135deg, #f8fafb 0%, #ffffff 100%);
      padding: 30px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      margin-bottom: 30px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .timeline h3 {
      margin: 0 0 30px 0;
      color: #232f3e;
      font-size: 16px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .timeline-item {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
      position: relative;
      padding: 0;
    }

    .timeline-item:last-child {
      margin-bottom: 0;
    }

    .timeline-item:not(:last-child)::after {
      content: '';
      position: absolute;
      left: 11px;
      top: 40px;
      width: 2px;
      height: calc(100% + 30px);
      background: linear-gradient(to bottom, #28a745, #ddd);
    }

    .timeline-item.pending:not(:last-child)::after {
      background-color: #ddd;
    }

    .timeline-item.completed:not(:last-child)::after {
      background-color: #28a745;
    }

    .timeline-dot {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background-color: #e5e7eb;
      border: 3px solid white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
      color: #666;
      transition: all 0.3s ease;
    }

    .timeline-item.active .timeline-dot {
      background-color: #232f3e;
      box-shadow: 0 0 0 4px rgba(35, 47, 62, 0.2), 0 2px 12px rgba(0, 0, 0, 0.15);
      color: white;
      font-size: 16px;
      transform: scale(1.15);
    }

    .timeline-dot.completed {
      background-color: #28a745;
      box-shadow: 0 2px 8px rgba(40, 167, 69, 0.3);
      color: white;
    }

    .timeline-dot.completed::after {
      content: '\2713';
    }

    .timeline-content {
      padding-top: 6px;
      flex: 1;
    }

    .timeline-content h4 {
      margin: 0 0 4px 0;
      color: #232f3e;
      font-size: 14px;
      font-weight: 600;
    }

    .timeline-content p {
      margin: 0;
      font-size: 12px;
      color: #999;
      line-height: 1.4;
    }

    .timeline-date {
      font-size: 11px;
      color: #bbb;
      margin-top: 4px;
    }

    /* ===== REFUND CALCULATION ===== */
    .refund-calc {
      background-color: #f9fafb;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      margin-bottom: 30px;
    }

    .refund-calc h3 {
      margin: 0 0 15px 0;
      color: #232f3e;
      font-size: 16px;
    }

    .calc-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      font-size: 14px;
      padding-bottom: 12px;
      border-bottom: 1px solid #e5e7eb;
    }

    .calc-row.grand-total {
      border-top: 2px solid #232f3e;
      padding-top: 15px;
      border-bottom: none;
      font-weight: 700;
      font-size: 16px;
      color: #232f3e;
    }

    .calc-input {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 12px;
    }

    .calc-input label {
      flex: 1;
      font-weight: 600;
      font-size: 14px;
    }

    .calc-input input {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 13px;
    }

    .calc-input input:focus {
      outline: none;
      border-color: #232f3e;
    }

    /* ===== ACTION BUTTONS ===== */
    .action-button-group {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .btn-primary, .btn-secondary, .btn-danger {
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background-color: #232f3e;
      color: white;
    }

    .btn-primary:hover {
      background-color: #37475a;
    }

    .btn-secondary {
      background-color: #f3f4f6;
      color: #333;
      border: 1px solid #ddd;
    }

    .btn-secondary:hover {
      background-color: #e5e7eb;
    }

    .btn-danger {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .btn-danger:hover {
      background-color: #f5c6cb;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1080px) {
      .detail-grid {
        grid-template-columns: 1fr;
      }

      .summary-card {
        flex: 1 1 48%;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 260px;
        left: -260px;
      }

      .sidebar.active {
        left: 0;
      }

      .main-content {
        padding: 15px;
      }

      .toggle-btn {
        display: block;
      }

      .close-btn {
        display: block;
      }

      .summary-card {
        flex: 1 1 100%;
      }

      .section-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .search-filter {
        flex-direction: column;
        width: 100%;
      }

      .search-bar {
        width: 100%;
      }

      .filter-select {
        width: 100%;
      }

      .data-table {
        font-size: 12px;
      }

      .data-table th,
      .data-table td {
        padding: 10px;
      }

      .action-buttons {
        flex-direction: column;
      }

      .modal-content {
        width: 95%;
      }

      .modal-body {
        padding: 15px;
      }
    }

    @media (max-width: 600px) {
      .summary-card {
        flex: 1 1 100%;
      }

      .action-button-group {
        flex-direction: column;
      }

      .btn-primary, .btn-secondary, .btn-danger {
        width: 100%;
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
  
    <!-- Main Content -->
    <div class="main-content">
      <h1>Refunds & Returns Panel</h1>

      <!-- Summary Cards -->
      <div class="summary-cards">
        <div class="summary-card" style="border-left-color: #ffc107;">
          <p>Pending Returns</p>
          <div class="summary-value" id="pendingCount">0</div>
        </div>
        <div class="summary-card" style="border-left-color: #28a745;">
          <p>Approved Returns</p>
          <div class="summary-value" id="approvedCount">0</div>
        </div>
        <div class="summary-card" style="border-left-color: #dc3545;">
          <p>Rejected Returns</p>
          <div class="summary-value" id="rejectedCount">0</div>
        </div>
        <div class="summary-card" style="border-left-color: #17a2b8;">
          <p>Total Refunded</p>
          <div class="summary-value" id="totalRefunded">$0.00</div>
        </div>
      </div>

      <!-- Returns Section -->
      <div class="returns-section">
        <div class="section-header">
          <div class="section-title">Return Requests</div>
          <div class="search-filter">
            <div class="search-bar">
              <span class="search-icon material-symbols-rounded">search</span>
              <input type="text" id="searchInput" placeholder="Search by Return ID, Order ID, Customer...">
            </div>
            <select class="filter-select" id="statusFilter">
              <option value="">All Status</option>
              <option value="Pending">Pending</option>
              <option value="Approved">Approved</option>
              <option value="Rejected">Rejected</option>
              <option value="Completed">Completed</option>
            </select>
          </div>
        </div>

        <table class="data-table" id="returnsTable">
          <thead>
            <tr>
              <th>Return ID</th>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Product</th>
              <th>Date Requested</th>
              <th>Reason</th>
              <th>Refund Amount</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="returnsTableBody">
          </tbody>
        </table>

        <div id="returnsPagination" class="pagination"></div>
      </div>
    </div>
  </div>

  <!-- Detail Modal -->
  <div class="modal" id="detailModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Return Details</h2>
        <button class="modal-close" id="modalClose">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Customer & Order Info -->
        <div class="detail-grid">
          <div class="detail-section">
            <h3>üë§ Customer Details</h3>
            <div class="detail-item">
              <label>Name:</label>
              <value id="detailCustomer"></value>
            </div>
            <div class="detail-item">
              <label>Email:</label>
              <value id="detailEmail"></value>
            </div>
            <div class="detail-item">
              <label>Phone:</label>
              <value id="detailPhone"></value>
            </div>
          </div>

          <div class="detail-section">
            <h3>üì¶ Order Details</h3>
            <div class="detail-item">
              <label>Order ID:</label>
              <value id="detailOrderId"></value>
            </div>
            <div class="detail-item">
              <label>Product:</label>
              <value id="detailProduct"></value>
            </div>
            <div class="detail-item">
              <label>Original Price:</label>
              <value id="detailPrice"></value>
            </div>
          </div>
        </div>

        <!-- Return Reason -->
        <div class="detail-section" style="margin-bottom: 30px;">
          <h3>üìù Return Reason</h3>
          <div class="detail-item">
            <label>Reason:</label>
          </div>
          <p id="detailReason" style="margin-top: 10px; line-height: 1.6; color: #333; font-size: 14px;"></p>
        </div>

        <!-- Images -->
        <div class="detail-section" style="margin-bottom: 30px;">
          <h3>üñºÔ∏è Uploaded Images</h3>
          <div id="detailImages" style="display: flex; gap: 12px; flex-wrap: wrap; margin-top: 10px;">
          </div>
        </div>

        <!-- Timeline -->
        <div class="timeline">
          <h3>üïí Return Timeline</h3>
          <div id="detailTimeline"></div>
        </div>

        <!-- Update Status -->
        <div class="detail-section" style="margin-bottom: 30px;">
          <h3>‚öôÔ∏è Update Return Status</h3>
          <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Return Status</label>
            <select id="returnStatusSelect" class="filter-select" style="width: 100%; padding: 10px 15px; border: 1px solid #ddd; border-radius: 6px;">
              <option value="Requested">Return Requested</option>
              <option value="Under Review">Under Review</option>
              <option value="Approved">Approved</option>
              <option value="Rejected">Rejected</option>
              <option value="Completed">Completed</option>
            </select>
          </div>
          <div style="margin-bottom: 15px;">
            <label style="display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px;">Status Notes</label>
            <textarea id="returnStatusNotes" placeholder="Add notes about this status update..." style="width: 100%; height: 80px; padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-family: Arial, sans-serif; font-size: 13px; resize: vertical;"></textarea>
          </div>
          <button class="btn-primary" onclick="window.updateReturnStatus()"><span class="material-symbols-rounded">check_circle</span> Update Status</button>
        </div>

        <!-- Refund Calculator -->
        <div class="refund-calc">
          <h3>üí∞ Refund Calculator</h3>
          <div class="calc-input">
            <label>Product Price</label>
            <input type="number" id="calcPrice" placeholder="0.00" step="0.01">
          </div>
          <div class="calc-input">
            <label>Shipping Fee</label>
            <input type="number" id="calcShipping" placeholder="0.00" step="0.01">
          </div>
          <div class="calc-input">
            <label>Platform Commission (%)</label>
            <input type="number" id="calcCommission" placeholder="5" step="0.01">
          </div>
          <div class="calc-input">
            <label>Return Fee</label>
            <input type="number" id="calcReturnFee" placeholder="0.00" step="0.01">
          </div>
          <div class="calc-row">
            <span>Commission Amount</span>
            <span id="calcCommissionAmount">$0.00</span>
          </div>
          <div class="calc-row">
            <span>Return Fee</span>
            <span id="calcReturnFeeAmount">$0.00</span>
          </div>
          <div class="calc-row grand-total">
            <span>Final Refund Amount</span>
            <span id="calcFinalRefund">$0.00</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-button-group">
          <button class="btn-primary" id="approveBtn"><span class="material-symbols-rounded">check_circle</span> Approve Return</button>
          <button class="btn-danger" id="rejectBtn"><span class="material-symbols-rounded">cancel</span> Reject Return</button>
          <button class="btn-secondary" id="modalCloseBtn"><span class="material-symbols-rounded">close</span> Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div class="modal" id="confirmModal">
    <div class="modal-content" style="max-width: 480px;">
      <div class="modal-header">
        <h2 id="confirmTitle">Confirm Action</h2>
        <button class="modal-close" id="confirmClose">&times;</button>
      </div>
      <div class="modal-body">
        <p id="confirmMessage" style="font-size: 14px; line-height: 1.6; margin-bottom: 20px;"></p>
        <div class="action-button-group" style="margin-top: 30px;">
          <button class="btn-secondary" id="confirmCancel" style="flex: 1;">Cancel</button>
          <button class="btn-primary" id="confirmYes" style="flex: 1;">Yes, Proceed</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== DUMMY DATA =====
    const dummyReturns = [
      {
        id: 'RET-001',
        orderId: 'ORD-001',
        customer: 'John Doe',
        email: 'john@example.com',
        phone: '+1 (555) 123-4567',
        product: 'Wireless Headphones',
        price: 89.99,
        dateRequested: '2025-11-22',
        reason: 'The headphones stopped working after 2 days. The left ear is not producing any sound.',
        refund: 89.99,
        status: 'Pending',
        timeline: ['Requested'],
        images: ['https://via.placeholder.com/100?text=Image+1', 'https://via.placeholder.com/100?text=Image+2']
      },
      {
        id: 'RET-002',
        orderId: 'ORD-002',
        customer: 'Jane Smith',
        email: 'jane@example.com',
        phone: '+1 (555) 234-5678',
        product: 'USB-C Cable',
        price: 15.99,
        dateRequested: '2025-11-21',
        reason: 'Received wrong color. Ordered white but got black.',
        refund: 15.99,
        status: 'Approved',
        timeline: ['Requested', 'Approved'],
        images: ['https://via.placeholder.com/100?text=Cable']
      },
      {
        id: 'RET-003',
        orderId: 'ORD-003',
        customer: 'Mike Johnson',
        email: 'mike@example.com',
        phone: '+1 (555) 345-6789',
        product: 'Phone Case',
        price: 24.99,
        dateRequested: '2025-11-20',
        reason: 'Case is damaged - has cracks on the corner.',
        refund: 24.99,
        status: 'Approved',
        timeline: ['Requested', 'Approved', 'Completed'],
        images: []
      },
      {
        id: 'RET-004',
        orderId: 'ORD-004',
        customer: 'Sarah Williams',
        email: 'sarah@example.com',
        phone: '+1 (555) 456-7890',
        product: 'Screen Protector',
        price: 9.99,
        dateRequested: '2025-11-19',
        reason: 'Not compatible with my phone model.',
        refund: 0,
        status: 'Rejected',
        timeline: ['Requested', 'Rejected'],
        images: []
      },
      {
        id: 'RET-005',
        orderId: 'ORD-005',
        customer: 'Tom Brown',
        email: 'tom@example.com',
        phone: '+1 (555) 567-8901',
        product: 'Laptop Stand',
        price: 45.99,
        dateRequested: '2025-11-18',
        reason: 'Change of mind. Product is too heavy for my desk.',
        refund: 45.99,
        status: 'Pending',
        timeline: ['Requested'],
        images: ['https://via.placeholder.com/100?text=Stand']
      },
      {
        id: 'RET-006',
        orderId: 'ORD-006',
        customer: 'Lisa Anderson',
        email: 'lisa@example.com',
        phone: '+1 (555) 678-9012',
        product: 'Keyboard',
        price: 79.99,
        dateRequested: '2025-11-17',
        reason: 'Keys are not responding properly.',
        refund: 79.99,
        status: 'Pending',
        timeline: ['Requested'],
        images: []
      },
      {
        id: 'RET-007',
        orderId: 'ORD-007',
        customer: 'David Lee',
        email: 'david@example.com',
        phone: '+1 (555) 789-0123',
        product: 'Mouse Pad',
        price: 12.99,
        dateRequested: '2025-11-16',
        reason: 'Surface is slippery, mouse does not grip.',
        refund: 12.99,
        status: 'Completed',
        timeline: ['Requested', 'Approved', 'Completed'],
        images: ['https://via.placeholder.com/100?text=Mousepad']
      },
      {
        id: 'RET-008',
        orderId: 'ORD-008',
        customer: 'Emma Davis',
        email: 'emma@example.com',
        phone: '+1 (555) 890-1234',
        product: 'USB Hub',
        price: 34.99,
        dateRequested: '2025-11-15',
        reason: 'Only 2 out of 4 USB ports are working.',
        refund: 34.99,
        status: 'Approved',
        timeline: ['Requested', 'Approved'],
        images: []
      }
    ];

    // ===== STATE ===== 
    let returns = JSON.parse(JSON.stringify(dummyReturns));
    let filteredReturns = [...returns];
    let currentPage = 1;
    const itemsPerPage = 10;
    let currentReturnDetail = null;
    let pendingAction = null;

    // ===== DOM ELEMENTS =====
    const sidebar = document.querySelector('.sidebar');
    const toggleBtn = document.getElementById('toggleBtn');
    const closeBtn = document.getElementById('closeBtn');
    const overlay = document.getElementById('overlay');
    const searchInput = document.getElementById('searchInput');
    const statusFilter = document.getElementById('statusFilter');
    const returnsTableBody = document.getElementById('returnsTableBody');
    const detailModal = document.getElementById('detailModal');
    const confirmModal = document.getElementById('confirmModal');
    const modalClose = document.getElementById('modalClose');
    const modalCloseBtn = document.getElementById('modalCloseBtn');
    const confirmClose = document.getElementById('confirmClose');

    // ===== SIDEBAR TOGGLE =====
    toggleBtn.addEventListener('click', () => {
      sidebar.classList.add('active');
      overlay.classList.add('active');
    });

    closeBtn.addEventListener('click', () => {
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
    });

    overlay.addEventListener('click', () => {
      sidebar.classList.remove('active');
      overlay.classList.remove('active');
      detailModal.classList.remove('active');
      confirmModal.classList.remove('active');
    });

    // ===== SEARCH & FILTER =====
    function applyFilters() {
      const searchTerm = searchInput.value.toLowerCase();
      const statusTerm = statusFilter.value;

      filteredReturns = returns.filter(ret => {
        const matchSearch = 
          ret.id.toLowerCase().includes(searchTerm) ||
          ret.orderId.toLowerCase().includes(searchTerm) ||
          ret.customer.toLowerCase().includes(searchTerm) ||
          ret.product.toLowerCase().includes(searchTerm);
        
        const matchStatus = statusTerm === '' || ret.status === statusTerm;

        return matchSearch && matchStatus;
      });

      currentPage = 1;
      renderReturnsTable();
      updateSummary();
    }

    searchInput.addEventListener('input', applyFilters);
    statusFilter.addEventListener('change', applyFilters);

    // ===== RENDER TABLE =====
    function renderReturnsTable() {
      returnsTableBody.innerHTML = '';
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageData = filteredReturns.slice(start, end);

      if (pageData.length === 0) {
        returnsTableBody.innerHTML = `
          <tr>
            <td colspan="9" style="text-align: center; padding: 40px; color: #999;">
              No return requests found
            </td>
          </tr>
        `;
        renderPagination();
        return;
      }

      pageData.forEach(ret => {
        const statusClass = `badge-${ret.status.toLowerCase()}`;
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><span class="return-id">${ret.id}</span></td>
          <td>${ret.orderId}</td>
          <td>${ret.customer}</td>
          <td>${ret.product}</td>
          <td>${ret.dateRequested}</td>
          <td style="max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="${ret.reason}">${ret.reason}</td>
          <td>$${ret.refund.toFixed(2)}</td>
          <td><span class="status-badge ${statusClass}">${ret.status}</span></td>
          <td>
            <div class="action-buttons">
              <button class="btn-view" onclick="viewDetail('${ret.id}')">View</button>
            </div>
          </td>
        `;
        returnsTableBody.appendChild(row);
      });

      renderPagination();
    }

    // ===== PAGINATION =====
    function renderPagination() {
      const paginationDiv = document.getElementById('returnsPagination');
      paginationDiv.innerHTML = '';
      const totalPages = Math.ceil(filteredReturns.length / itemsPerPage);

      const prevBtn = document.createElement('button');
      prevBtn.textContent = 'Prev';
      prevBtn.disabled = currentPage === 1;
      prevBtn.addEventListener('click', () => {
        if (currentPage > 1) {
          currentPage--;
          renderReturnsTable();
        }
      });
      paginationDiv.appendChild(prevBtn);

      for (let i = 1; i <= totalPages; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.textContent = i;
        pageBtn.className = i === currentPage ? 'active' : '';
        pageBtn.addEventListener('click', () => {
          currentPage = i;
          renderReturnsTable();
        });
        paginationDiv.appendChild(pageBtn);
      }

      const nextBtn = document.createElement('button');
      nextBtn.textContent = 'Next';
      nextBtn.disabled = currentPage === totalPages;
      nextBtn.addEventListener('click', () => {
        if (currentPage < totalPages) {
          currentPage++;
          renderReturnsTable();
        }
      });
      paginationDiv.appendChild(nextBtn);
    }

    // ===== VIEW DETAIL =====
    function viewDetail(returnId) {
      currentReturnDetail = returns.find(r => r.id === returnId);
      if (!currentReturnDetail) return;

      // Populate modal
      document.getElementById('modalTitle').textContent = `Return Details - ${currentReturnDetail.id}`;
      document.getElementById('detailCustomer').textContent = currentReturnDetail.customer;
      document.getElementById('detailEmail').textContent = currentReturnDetail.email;
      document.getElementById('detailPhone').textContent = currentReturnDetail.phone;
      document.getElementById('detailOrderId').textContent = currentReturnDetail.orderId;
      document.getElementById('detailProduct').textContent = currentReturnDetail.product;
      document.getElementById('detailPrice').textContent = `$${currentReturnDetail.price.toFixed(2)}`;
      document.getElementById('detailReason').textContent = currentReturnDetail.reason;

      // Images
      const imagesDiv = document.getElementById('detailImages');
      imagesDiv.innerHTML = '';
      if (currentReturnDetail.images.length > 0) {
        currentReturnDetail.images.forEach(img => {
          const imgEl = document.createElement('img');
          imgEl.src = img;
          imgEl.style.width = '100px';
          imgEl.style.height = '100px';
          imgEl.style.borderRadius = '6px';
          imgEl.style.objectFit = 'cover';
          imagesDiv.appendChild(imgEl);
        });
      } else {
        imagesDiv.innerHTML = '<p style="color: #999;">No images uploaded</p>';
      }

      // Timeline
      renderTimeline(currentReturnDetail.status);

      // Refund calculator
      document.getElementById('calcPrice').value = currentReturnDetail.price.toFixed(2);
      document.getElementById('calcShipping').value = '0.00';
      document.getElementById('calcCommission').value = '5';
      document.getElementById('calcReturnFee').value = '0.00';
      updateCalculator();

      // Status update form
      const statusSelect = document.getElementById('returnStatusSelect');
      if (statusSelect) {
        statusSelect.value = currentReturnDetail.status;
      }
      const statusNotes = document.getElementById('returnStatusNotes');
      if (statusNotes) {
        statusNotes.value = '';
      }

      // Setup buttons
      document.getElementById('approveBtn').onclick = () => showConfirm('approve');
      document.getElementById('rejectBtn').onclick = () => showConfirm('reject');

      detailModal.classList.add('active');
      overlay.classList.add('active');
    }

    // ===== TIMELINE RENDER =====
    function renderTimeline(status) {
      const timelineDiv = document.getElementById('detailTimeline');
      timelineDiv.innerHTML = '';

      // Define all possible steps with descriptions
      const allSteps = [
        { label: 'Return Requested', key: 'Requested', description: 'Customer initiated return request' },
        { label: 'Under Review', key: 'Under Review', description: 'Seller reviewing return request' },
        { label: 'Approved', key: 'Approved', description: 'Return approved by seller' },
        { label: 'Rejected', key: 'Rejected', description: 'Return rejected by seller' },
        { label: 'Refund Completed', key: 'Completed', description: 'Refund processed and completed' }
      ];

      // Get the current timeline sequence based on actual status
      let steps = [];
      
      // Always include Requested and Under Review
      steps.push(allSteps[0]); // Requested
      steps.push(allSteps[1]); // Under Review
      
      // Include the decision step (Approved or Rejected)
      if (status === 'Rejected') {
        steps.push(allSteps[3]); // Rejected
      } else if (status === 'Approved' || status === 'Completed') {
        steps.push(allSteps[2]); // Approved
        if (status === 'Completed') {
          steps.push(allSteps[4]); // Refund Completed
        }
      } else if (status === 'Pending') {
        // For pending, show up to Under Review
      }

      // Render timeline items
      steps.forEach((step, idx) => {
        const isCompleted = currentReturnDetail.timeline.includes(step.key);
        const isActive = step.key === status;
        const isCurrent = isActive && !isCompleted;

        const timelineItem = document.createElement('div');
        const statusClass = isCompleted ? 'completed' : (isCurrent ? 'active' : 'pending');
        timelineItem.className = `timeline-item ${statusClass}`;

        const dot = document.createElement('div');
        dot.className = `timeline-dot ${isCompleted ? 'completed' : ''}`;
        if (isActive && !isCompleted) {
          dot.textContent = '‚óè';
        } else if (isCompleted) {
          // checkmark will be added via CSS ::after
        } else {
          dot.textContent = idx + 1;
        }
        timelineItem.appendChild(dot);

        const content = document.createElement('div');
        content.className = 'timeline-content';
        const statusText = isCompleted ? 'Completed' : (isActive ? 'In Progress' : 'Pending');
        const timestamp = isCompleted ? new Date().toLocaleDateString() : '';
        content.innerHTML = `
          <h4>${step.label}</h4>
          <p>${step.description}</p>
          <div class="timeline-date">${statusText}${timestamp ? ' ‚Ä¢ ' + timestamp : ''}</div>
        `;
        timelineItem.appendChild(content);

        timelineDiv.appendChild(timelineItem);
      });
    }

    // ===== UPDATE RETURN STATUS =====
    window.updateReturnStatus = function updateReturnStatus() {
      if (!currentReturnDetail) return;

      const newStatus = document.getElementById('returnStatusSelect').value;
      const notes = document.getElementById('returnStatusNotes').value;

      // Update return status
      const returnIndex = returns.findIndex(r => r.id === currentReturnDetail.id);
      if (returnIndex !== -1) {
        const oldStatus = returns[returnIndex].status;
        returns[returnIndex].status = newStatus;
        
        // Add status steps to timeline based on progression
        if (newStatus === 'Under Review' && !returns[returnIndex].timeline.includes('Under Review')) {
          returns[returnIndex].timeline.push('Under Review');
        }
        
        if ((newStatus === 'Approved' || newStatus === 'Rejected') && !returns[returnIndex].timeline.includes(newStatus)) {
          returns[returnIndex].timeline.push(newStatus);
        }
        
        if (newStatus === 'Completed' && !returns[returnIndex].timeline.includes('Completed')) {
          returns[returnIndex].timeline.push('Completed');
        }
        
        currentReturnDetail = returns[returnIndex];

        // Refresh the modal display
        const returnDetail = returns[returnIndex];
        renderTimeline(returnDetail.status);

        // Update summary cards
        updateSummary();

        // Re-render table
        renderReturnsTable();

        // Show confirmation message with detailed info
        const action = newStatus === 'Approved' ? '‚úì Approved' : 
                      newStatus === 'Rejected' ? '‚úó Rejected' : 
                      newStatus === 'Under Review' ? '‚óä Moved to Review' :
                      newStatus === 'Completed' ? '‚úì Completed' : newStatus;
        
        alert(`Return ${action}!\n\n${notes ? 'Notes: ' + notes : 'No additional notes'}`);
        document.getElementById('returnStatusNotes').value = '';
      }
    };

    // ===== CALCULATOR =====
    ['calcPrice', 'calcShipping', 'calcCommission', 'calcReturnFee'].forEach(id => {
      document.getElementById(id).addEventListener('input', updateCalculator);
    });

    function updateCalculator() {
      const price = parseFloat(document.getElementById('calcPrice').value) || 0;
      const commission = parseFloat(document.getElementById('calcCommission').value) || 0;
      const returnFee = parseFloat(document.getElementById('calcReturnFee').value) || 0;

      const commissionAmount = price * (commission / 100);
      const finalRefund = Math.max(0, price - commissionAmount - returnFee);

      document.getElementById('calcCommissionAmount').textContent = `$${commissionAmount.toFixed(2)}`;
      document.getElementById('calcReturnFeeAmount').textContent = `$${returnFee.toFixed(2)}`;
      document.getElementById('calcFinalRefund').textContent = `$${finalRefund.toFixed(2)}`;
    }

    // ===== CONFIRMATION =====
    function showConfirm(action) {
      pendingAction = action;
      const title = action === 'approve' ? 'Approve Return' : 'Reject Return';
      const message = action === 'approve' 
        ? `Are you sure you want to approve the return for ${currentReturnDetail.id}? The refund amount will be $${currentReturnDetail.refund.toFixed(2)}.`
        : `Are you sure you want to reject the return for ${currentReturnDetail.id}? This action cannot be undone.`;

      document.getElementById('confirmTitle').textContent = title;
      document.getElementById('confirmMessage').textContent = message;
      confirmModal.classList.add('active');
    }

    document.getElementById('confirmYes').addEventListener('click', () => {
      if (pendingAction === 'approve') {
        currentReturnDetail.status = 'Approved';
        currentReturnDetail.timeline.push('Approved');
      } else if (pendingAction === 'reject') {
        currentReturnDetail.status = 'Rejected';
        currentReturnDetail.timeline.push('Rejected');
      }

      confirmModal.classList.remove('active');
      detailModal.classList.remove('active');
      overlay.classList.remove('active');
      renderReturnsTable();
      updateSummary();

      alert(`Return ${pendingAction} successfully!`);
    });

    document.getElementById('confirmCancel').addEventListener('click', () => {
      confirmModal.classList.remove('active');
    });

    confirmClose.addEventListener('click', () => {
      confirmModal.classList.remove('active');
    });

    // ===== SUMMARY =====
    function updateSummary() {
      const pending = returns.filter(r => r.status === 'Pending').length;
      const approved = returns.filter(r => r.status === 'Approved').length;
      const rejected = returns.filter(r => r.status === 'Rejected').length;
      const totalRefunded = returns
        .filter(r => r.status === 'Completed')
        .reduce((sum, r) => sum + r.refund, 0);

      document.getElementById('pendingCount').textContent = pending;
      document.getElementById('approvedCount').textContent = approved;
      document.getElementById('rejectedCount').textContent = rejected;
      document.getElementById('totalRefunded').textContent = `$${totalRefunded.toFixed(2)}`;
    }

    // ===== MODAL CLOSE =====
    modalClose.addEventListener('click', () => {
      detailModal.classList.remove('active');
      overlay.classList.remove('active');
    });

    modalCloseBtn.addEventListener('click', () => {
      detailModal.classList.remove('active');
      overlay.classList.remove('active');
    });

    // ===== INIT =====
    function initializeRefundsReturns() {
      console.log('Initializing Refunds & Returns page');
      try {
        renderReturnsTable();
        updateSummary();
        console.log('Refunds & Returns initialized successfully');
      } catch (e) {
        console.error('Error initializing Refunds & Returns:', e);
      }
    }

    // Call immediately (for fetch/eval loading in index)
    initializeRefundsReturns();
    
    // Also call on DOMContentLoaded (for direct page load)
    document.addEventListener('DOMContentLoaded', initializeRefundsReturns);

    // ===== EXPORT FUNCTIONS TO WINDOW =====
    // Make all functions accessible from onclick handlers when loaded via fetch/eval
    window.viewDetail = viewDetail;
    window.applyFilters = applyFilters;
    window.updateSummary = updateSummary;
    window.renderReturnsTable = renderReturnsTable;
    window.renderPagination = renderPagination;
    window.renderTimeline = renderTimeline;
    window.updateCalculator = updateCalculator;
    window.showConfirm = showConfirm;
    window.initializeRefundsReturns = initializeRefundsReturns;
    window.updateReturnStatus = updateReturnStatus;
  </script>
</body>
</html>
