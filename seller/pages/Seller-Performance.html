<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seller Performance & Analytics</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
    }

    /* Content */
    .main-content {
      padding: 20px;
      margin-top: 20px;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    .main-content h1 {
      color: #232f3e;
      margin-bottom: 20px;
      font-size: 24px;
    }

    /* Metrics Grid */
    .metrics-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-bottom: 40px;
    }

    .metric-card {
      flex: 1 1 220px;
      background: white;
      padding: 15px;
      border-radius: 10px;
      border-left: 5px solid;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .metric-card:hover {
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
      transform: translateY(-4px);
    }

    .metric-card p {
      opacity: 0.6;
      font-size: 14px;
      margin-bottom: 10px;
    }

    .metric-value {
      font-size: 22px;
      font-weight: 700;
      color: #232f3e;
    }

    .metric-label {
      font-size: 12px;
      color: #666;
      margin-top: 8px;
    }

    .metric-change {
      font-size: 12px;
      color: #28a745;
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .metric-change.negative {
      color: #dc3545;
    }

    /* Charts Section */
    .charts-section {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
      margin-bottom: 40px;
    }

    .chart-card {
      flex: 1 1 48%;
      min-height: 300px;
      background: white;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding: 15px;
    }

    .chart-title {
      font-size: 16px;
      font-weight: 600;
      color: #232f3e;
    }

    .chart-tabs {
      display: flex;
      gap: 10px;
    }

    .chart-tab {
      padding: 8px 16px;
      border: 1px solid #ddd;
      background-color: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    .chart-tab.active {
      background-color: #232f3e;
      color: white;
      border-color: #232f3e;
    }

    .chart-tab:hover {
      background-color: #f5f5f5;
    }

    canvas {
      max-width: 100%;
      max-height: 300px;
    }

    /* Analytics Sections */
    .analytics-section {
      background-color: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: #232f3e;
    }

    .controls {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .filter-select {
      padding: 10px 15px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 13px;
      background-color: white;
      cursor: pointer;
      min-width: 140px;
    }

    .filter-select:focus {
      outline: none;
      border-color: #232f3e;
    }

    /* Table */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }

    .data-table thead tr {
      border-bottom: 2px solid #ddd;
      background-color: #f5f5f5;
    }

    .data-table th {
      padding: 15px;
      text-align: left;
      font-weight: 600;
      color: #232f3e;
      font-size: 13px;
      text-transform: uppercase;
    }

    .data-table tbody tr {
      border-bottom: 1px solid #ddd;
      transition: background-color 0.2s;
    }

    .data-table tbody tr:hover {
      background-color: #f5f5f5;
    }

    .data-table td {
      padding: 15px;
      font-size: 13px;
    }

    .highlight {
      background: linear-gradient(90deg, rgba(59,130,246,0.06), rgba(59,130,246,0.02));
      border-left: 4px solid rgba(59,130,246,0.12);
    }

    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-received {
      background-color: #d4edda;
      color: #155724;
    }

    .status-processing {
      background-color: #fff3cd;
      color: #856404;
    }

    .status-deduction {
      background-color: #f8d7da;
      color: #721c24;
    }

    .status-refund {
      background-color: #d1ecf1;
      color: #0c5460;
    }

    .amount-positive {
      color: #28a745;
      font-weight: 600;
    }

    .amount-negative {
      color: #dc3545;
      font-weight: 600;
    }

    /* Funnel */
    .funnel {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .funnel-step {
      height: 24px;
      border-radius: 6px;
      background: #f0f0f0;
      display: flex;
      align-items: center;
      padding: 0 12px;
      color: #232f3e;
      font-weight: 600;
      font-size: 12px;
    }

    /* Rating bars */
    .rating-bars {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .rating-row {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .bar {
      height: 12px;
      background: #f0f0f0;
      border-radius: 999px;
      flex: 1;
      overflow: hidden;
    }

    .bar .fill {
      height: 100%;
      background: #0066c0;
      border-radius: 999px;
    }

    /* Side cards */
    .side-cards {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .small-card {
      background: #f5f5f5;
      padding: 12px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      font-size: 13px;
    }

    /* Responsive */
    @media (max-width: 1080px) {
      .chart-card {
        flex: 1 1 100%;
        min-height: 250px;
      }

      .metric-card {
        flex: 1 1 48%;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 260px;
        left: -260px;
      }

      .sidebar.active {
        left: 0;
      }

      .main-content {
        padding: 15px;
      }

      .toggle-btn {
        display: block;
      }

      .close-btn {
        display: block;
      }

      .metric-card {
        flex: 1 1 100%;
      }

      .section-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .controls {
        flex-direction: column;
        width: 100%;
      }

      .filter-select {
        width: 100%;
      }

      .data-table {
        font-size: 12px;
      }

      .data-table th,
      .data-table td {
        padding: 10px;
      }

      .chart-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .chart-tabs {
        width: 100%;
        justify-content: flex-start;
      }
    }

    @media (max-width: 710px) {
      .metric-card {
        flex: 1 1 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
   

    <div class="overlay" id="overlay"></div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="page active" id="performancePage">
        <h1>Performance & Analytics</h1>

        <!-- KPI Cards - Will be generated dynamically -->
        <div class="metrics-grid" id="metricsContainer"></div>

        <!-- Sales Analytics Chart -->
        <div class="charts-section">
          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Sales Analytics</div>
              <div class="chart-tabs">
                <button class="chart-tab active" data-chart="daily" onclick="switchSalesChart('daily')">Daily</button>
                <button class="chart-tab" data-chart="weekly" onclick="switchSalesChart('weekly')">Weekly</button>
                <button class="chart-tab" data-chart="monthly" onclick="switchSalesChart('monthly')">Monthly</button>
              </div>
            </div>
            <canvas id="salesLineChart" height="80"></canvas>
          </div>

          <div class="chart-card">
            <div class="chart-header">
              <div class="chart-title">Conversion Funnel</div>
            </div>
            <div style="padding: 20px;">
              <div class="funnel">
                <div class="funnel-step" style="width:100%">Product Views: 31,200 (100%)</div>
                <div class="funnel-step" style="width:76%">Add to Cart: 6,120 (19.6%)</div>
                <div class="funnel-step" style="width:19%">Orders: 1,192 (3.8%)</div>
              </div>
              <div class="side-cards" style="margin-top: 20px;">
                <div class="small-card"><div>Total Views</div><div>31,200</div></div>
                <div class="small-card"><div>Cart Rate</div><div>19.6%</div></div>
                <div class="small-card"><div>Order Rate</div><div>3.8%</div></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Product Views -->
        <div class="analytics-section">
          <div class="section-header">
            <div class="section-title"><span class="material-symbols-rounded">bar_chart</span>Product Views Analytics</div>
            <div class="controls">
              <select id="viewsRange" class="filter-select" onchange="renderProductViews()">
                <option value="7">Last 7 days</option>
                <option value="30" selected>Last 30 days</option>
                <option value="90">Last 90 days</option>
              </select>
            </div>
          </div>
          <canvas id="viewsBarChart" height="80"></canvas>
          <h3 style="margin-top:20px; font-size:14px; color:#232f3e; font-weight:600">Most Viewed Products</h3>
          <table class="data-table">
            <thead>
              <tr>
                <th>Product</th>
                <th>Views</th>
                <th>Change</th>
              </tr>
            </thead>
            <tbody id="mostViewed"></tbody>
          </table>
        </div>

        <!-- Best Selling Products -->
        <div class="analytics-section">
          <div class="section-title"><span class="material-symbols-rounded">shopping_cart</span>Best-Selling Products (Top 5)</div>
          <table class="data-table">
            <thead>
              <tr>
                <th>Product</th>
                <th>Units Sold</th>
                <th>Revenue</th>
                <th>Category</th>
              </tr>
            </thead>
            <tbody id="bestSelling"></tbody>
          </table>
        </div>

        <!-- Refunds & Returns -->
        <div class="analytics-section">
          <div class="section-title"><span class="material-symbols-rounded">assignment_return</span>Highest Refund / Return Products</div>
          <table class="data-table">
            <thead>
              <tr>
                <th>Product</th>
                <th>Refund Rate</th>
                <th>Units Returned</th>
                <th>Reason</th>
              </tr>
            </thead>
            <tbody id="refundsTable"></tbody>
          </table>
        </div>

        <!-- Traffic Sources & Ratings Grid -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
          <!-- Traffic Sources -->
          <div class="analytics-section">
            <div class="section-title"><span class="material-symbols-rounded">public</span>Traffic Sources</div>
            <canvas id="trafficDonut" height="100"></canvas>
            <table class="data-table" style="margin-top: 15px;">
              <thead>
                <tr><th>Source</th><th>%</th></tr>
              </thead>
              <tbody id="trafficList"></tbody>
            </table>
          </div>

          <!-- Seller Rating -->
          <div class="analytics-section">
            <div class="section-title"><span class="material-symbols-rounded">star</span>Seller Rating Overview</div>
            <div style="padding: 20px 0;">
              <div style="text-align: center; margin-bottom: 20px;">
                <div style="font-size: 48px; font-weight: 700; color: #232f3e;">4.6</div>
                <div style="color: #666; margin-top: 4px;">Average Rating • <span id="totalReviews">1,320 reviews</span></div>
              </div>
              <div class="rating-bars">
                <div class="rating-row"><span>5★</span><div class="bar"><div class="fill" style="width:72%"></div></div><span>72%</span></div>
                <div class="rating-row"><span>4★</span><div class="bar"><div class="fill" style="width:15%"></div></div><span>15%</span></div>
                <div class="rating-row"><span>3★</span><div class="bar"><div class="fill" style="width:7%"></div></div><span>7%</span></div>
                <div class="rating-row"><span>2★</span><div class="bar"><div class="fill" style="width:3%"></div></div><span>3%</span></div>
                <div class="rating-row"><span>1★</span><div class="bar"><div class="fill" style="width:3%"></div></div><span>3%</span></div>
              </div>
            </div>
          </div>
        </div>

        <footer style="text-align: center; color: #999; font-size: 13px; padding: 10px 0;">Seller Performance Dashboard • Dummy data for demo</footer>
      </div>
    </div>
  </div>

  <script>
    /***** Dummy Analytics Data *****/
    const DUMMY = {
      metrics: [
        {label: 'Daily Sales', value: 1280, change: 6.5, positive: true, color: '#28a745', icon: 'trending_up'},
        {label: 'Weekly Sales', value: 8760, change: 12, positive: true, color: '#0066c0', icon: 'trending_up'},
        {label: 'Monthly Sales', value: 34200, change: 3.2, positive: true, color: '#ffc107', icon: 'trending_up'},
        {label: 'Conversion Rate', value: '3.8%', change: -0.2, positive: false, color: '#dc3545', icon: 'trending_down'}
      ],
      sales: {
        daily: {labels: ['8am','10am','12pm','2pm','4pm','6pm','8pm'], data:[120,200,340,280,300,380,420]},
        weekly: {labels:['Mon','Tue','Wed','Thu','Fri','Sat','Sun'], data:[1200,1500,1300,1700,1800,1900,1600]},
        monthly: {labels:['Week1','Week2','Week3','Week4'], data:[7200,8800,9400,9500]}
      },
      views: [
        {product:'Wireless Headphones', views:10240, change: 12},
        {product:'Smart Watch', views:8420, change: -4},
        {product:'Coffee Maker', views:7820, change: 6},
        {product:'Running Shoes', views:6520, change: 2},
        {product:'Desk Lamp', views:4220, change: 18}
      ],
      bestSelling: [
        {product:'Wireless Headphones', units:1200, revenue:48000, category:'Electronics'},
        {product:'Smart Watch', units:980, revenue:39200, category:'Electronics'},
        {product:'Coffee Maker', units:620, revenue:31000, category:'Home'},
        {product:'Running Shoes', units:430, revenue:17200, category:'Fashion'},
        {product:'Desk Lamp', units:300, revenue:4200, category:'Home'}
      ],
      refunds: [
        {product:'Smart Watch', rate:'5.2%', units:51, reason:'Battery issue'},
        {product:'Running Shoes', rate:'3.9%', units:17, reason:'Size mismatch'},
        {product:'Wireless Headphones', rate:'2.1%', units:25, reason:'Sound issue'}
      ],
      traffic: [
        {source:'Search', pct:38},
        {source:'Homepage', pct:18},
        {source:'Ads', pct:14},
        {source:'Social', pct:12},
        {source:'Direct', pct:10},
        {source:'Email', pct:8}
      ]
    };

    // Chart instances
    let salesLineChart, viewsBarChart, trafficDonut;

    // ===== RENDER METRIC CARDS =====
    function renderMetricCards() {
      const container = document.getElementById('metricsContainer');
      if (!container) {
        console.warn('metricsContainer not found');
        return;
      }
      
      try {
        container.innerHTML = '';
        DUMMY.metrics.forEach(metric => {
          const card = document.createElement('div');
          card.className = 'metric-card';
          card.style.borderLeftColor = metric.color;
          card.innerHTML = `
            <p>${metric.label}</p>
            <div class="metric-value">$${metric.value.toLocaleString()}</div>
            <div class="metric-change ${!metric.positive ? 'negative' : ''}">
              <span class="material-symbols-rounded" style="font-size:14px">${metric.icon}</span>
              ${metric.positive ? '+' : ''}${metric.change}% ${metric.positive ? 'vs yesterday' : 'vs last month'}
            </div>
          `;
          container.appendChild(card);
        });
        console.log('Metric cards rendered successfully');
      } catch (e) {
        console.error('Error rendering metric cards:', e);
      }
    }

    // Initialize
    function init() {
      console.log('Seller Performance init() called');
      try {
        renderMetricCards();
        renderSalesChart('monthly');
        renderProductViews();
        renderBestSelling();
        renderRefunds();
        renderTraffic();
        console.log('Seller Performance fully initialized');
      } catch (e) {
        console.error('Error in Seller Performance init:', e);
      }
    }

    // Call immediately (for fetch/eval loading in index)
    init();
    
    // Also call with small delay to ensure DOM is ready
    setTimeout(() => {
      if (document.getElementById('metricsContainer')) {
        init();
      }
    }, 100);

    function switchSalesChart(period) {
      document.querySelectorAll('.chart-tabs .chart-tab').forEach((btn, i) => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-chart') === period) btn.classList.add('active');
      });
      renderSalesChart(period);
    }

    function renderSalesChart(period) {
      try {
        const data = DUMMY.sales[period] || DUMMY.sales.monthly;
        const ctx = document.getElementById('salesLineChart');
        if (!ctx) {
          console.warn('salesLineChart canvas not found');
          return;
        }
        
        if(salesLineChart) salesLineChart.destroy();
        salesLineChart = new Chart(ctx, {
          type:'line',
          data:{labels:data.labels, datasets:[{label:'Sales', data:data.data, borderColor:'rgba(0,102,192,0.9)', backgroundColor:'rgba(0,102,192,0.1)', tension:0.3, fill:true, pointRadius:4, pointBackgroundColor:'#0066c0'}]},
          options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}, tooltip:{mode:'index'}}, scales:{y:{beginAtZero:true}}}
        });
        console.log('Sales chart rendered for period:', period);
      } catch (e) {
        console.error('Error rendering sales chart:', e);
      }
    }

    function renderProductViews() {
      try {
        const tbody = document.getElementById('mostViewed');
        if (!tbody) {
          console.warn('mostViewed table body not found');
          return;
        }
        
        tbody.innerHTML='';
        DUMMY.views.forEach((v) => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${v.product}</td><td>${v.views.toLocaleString()}</td><td style='color:${v.change>=0?"#28a745":"#dc3545"}'>${v.change>=0?"+":""}${v.change}%</td>`;
          tbody.appendChild(tr);
        });

        const ctx = document.getElementById('viewsBarChart');
        if (!ctx) {
          console.warn('viewsBarChart canvas not found');
          return;
        }
        
        if(viewsBarChart) viewsBarChart.destroy();
        viewsBarChart = new Chart(ctx, {type:'bar', data:{labels:DUMMY.views.map(v=>v.product), datasets:[{label:'Views', data:DUMMY.views.map(v=>v.views), backgroundColor:'rgba(0,102,192,0.85)'}]}, options:{indexAxis:'y', responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}}});
        console.log('Product views rendered successfully');
      } catch (e) {
        console.error('Error rendering product views:', e);
      }
    }

    function renderBestSelling() {
      try {
        const tbody = document.getElementById('bestSelling');
        if (!tbody) {
          console.warn('bestSelling table body not found');
          return;
        }
        
        tbody.innerHTML='';
        const totalRevenue = DUMMY.bestSelling.reduce((s,p)=>s+p.revenue,0);
        DUMMY.bestSelling.forEach((p, i) => {
          const tr = document.createElement('tr');
          if(i<3) tr.classList.add('highlight');
          const pct = ((p.revenue/totalRevenue)*100).toFixed(1);
          tr.innerHTML = `<td><strong>${p.product}</strong></td><td>${p.units}</td><td>$${p.revenue.toLocaleString()} <span style="font-size:11px;color:#999">${pct}%</span></td><td>${p.category}</td>`;
          tbody.appendChild(tr);
        });
        console.log('Best selling products rendered');
      } catch (e) {
        console.error('Error rendering best selling:', e);
      }
    }

    function renderRefunds() {
      try {
        const tbody = document.getElementById('refundsTable');
        if (!tbody) {
          console.warn('refundsTable table body not found');
          return;
        }
        
        tbody.innerHTML='';
        DUMMY.refunds.forEach(r => {
          const tr = document.createElement('tr');
          tr.innerHTML = `<td>${r.product}</td><td>${r.rate}</td><td>${r.units}</td><td>${r.reason}</td>`;
          tbody.appendChild(tr);
        });
        console.log('Refunds table rendered');
      } catch (e) {
        console.error('Error rendering refunds:', e);
      }
    }

    function renderTraffic() {
      try {
        const ctx = document.getElementById('trafficDonut');
        if (!ctx) {
          console.warn('trafficDonut canvas not found');
          return;
        }
        
        if(trafficDonut) trafficDonut.destroy();
        trafficDonut = new Chart(ctx, {type:'doughnut', data:{labels:DUMMY.traffic.map(t=>t.source), datasets:[{data:DUMMY.traffic.map(t=>t.pct), backgroundColor:['#0066c0','#28a745','#ffc107','#8b5cf6','#dc3545','#06b6d4']}]}, options:{responsive:true, maintainAspectRatio:false, plugins:{legend:{position:'bottom'}}}});

        const list = document.getElementById('trafficList');
        if (!list) {
          console.warn('trafficList table body not found');
          return;
        }
        
        list.innerHTML='';
        DUMMY.traffic.forEach(t=>{ const tr = document.createElement('tr'); tr.innerHTML = `<td>${t.source}</td><td>${t.pct}%</td>`; list.appendChild(tr); });
        console.log('Traffic sources rendered');
      } catch (e) {
        console.error('Error rendering traffic:', e);
      }
    }

    // Load on ready
    document.addEventListener('DOMContentLoaded', init);

    // ===== EXPORT FUNCTIONS TO WINDOW =====
    // Make all functions accessible from onclick handlers when loaded via fetch/eval
    window.init = init;
    window.switchSalesChart = switchSalesChart;
    window.renderSalesChart = renderSalesChart;
    window.renderProductViews = renderProductViews;
    window.renderBestSelling = renderBestSelling;
    window.renderRefunds = renderRefunds;
    window.renderTraffic = renderTraffic;
    window.renderMetricCards = renderMetricCards;
  </script>
</body>
</html>
