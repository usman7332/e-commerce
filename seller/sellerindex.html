<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Seller Dashboard</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
  <style>
    /* Reset */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background-color: #f5f5f5; }

    /* Header */
    .header-btn {
      background-color: #232f3e;
      padding: 10px;
      display: flex;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
    }
    .toggle-btn { background: none; border: none; color: white; font-size: 26px; cursor: pointer; }
    .header-btn h2 { color: white; margin-left: 20px; font-size: 20px; }

    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 0;
      left: -260px;
      width: 260px;
      height: 100%;
      background-color: #232f3e;
      color: white;
      transition: left 0.3s ease;
      display: flex;
      flex-direction: column;
      z-index: 1000;
      padding-top: 60px;
    }
    .sidebar.active { left: 0; }

    .sidebar-header { display: flex; justify-content: space-between; align-items: center; padding: 20px; background: #131921; }
    .sidebar-header h2 { font-size: 18px; font-weight: 600; }
    .close-btn { background: none; border: none; color: white; font-size: 26px; cursor: pointer; }

    .nav-menu { list-style: none; padding: 0; margin: 0; }
    .nav-item a {
      display: block;
      padding: 15px 20px;
      color: white;
      text-decoration: none;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      cursor: pointer;
      transition: background-color 0.2s;
      font-size: 14px;
    }
    .nav-item a:hover { background-color: #37475a; }
    .nav-item a.active { background-color: #37475a; }

    /* Overlay */
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.5);
      opacity: 0; visibility: hidden;
      transition: 0.3s;
      z-index: 500;
    }
    .overlay.active { opacity: 1; visibility: visible; }

    /* Content */
    .main-content { padding: 20px; margin-top: 20px; transition: margin-left 0.3s; }
    .page { display: none; }
    .page.active { display: block; }

    /* Fix for loaded page sidebars */
    .main-content .sidebar { display: none; }
    .main-content .overlay { display: none; }
    .main-content .toggle-btn { cursor: pointer; }
    .main-content .close-btn { cursor: pointer; }

    /* Responsive Sidebar */
    @media (max-width: 768px) {
      .sidebar { width: 260px; left: -260px; }
      .sidebar.active { left: 0; }
      .toggle-btn { display: block; }
      .main-content { padding: 15px; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="header-btn">
      <button class="toggle-btn" id="toggleBtn"><span class="material-symbols-rounded">menu</span></button>
      <h2>Seller Dashboard</h2>
    </div>
  </header>

  <!-- Sidebar -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2>Seller Hub</h2>
      <button class="close-btn" id="closeBtn"><span class="material-symbols-rounded">close</span></button>
    </div>
    <ul class="nav-menu">
      <li class="nav-item"><a data-page="Dashboard" class="active">Dashboard</a></li>
      <li class="nav-item"><a data-page="Order-management">Orders</a></li>
      <li class="nav-item"><a data-page="Product-Management">Products</a></li>
      <li class="nav-item"><a data-page="Inventory-management">Inventory</a></li>
      <li class="nav-item"><a data-page="Delivery-panel">Delivery</a></li>
      <li class="nav-item"><a data-page="Seller-Performance">Analytics</a></li>
      <li class="nav-item"><a data-page="Refunds-Returns">Return/Refund</a></li>
      <li class="nav-item"><a data-page="settings">Settings</a></li>
    </ul>
  </aside>

  <!-- Overlay -->
  <div class="overlay" id="overlay"></div>

  <!-- Main Content -->
  <div class="main-content" id="contentArea">
    <h1>Welcome to Seller Dashboard</h1>
    <p>Select a page from the sidebar to view content.</p>
  </div>

  <!-- JavaScript -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      const sidebar = document.getElementById("sidebar");
      const toggleBtn = document.getElementById("toggleBtn");
      const closeBtn = document.getElementById("closeBtn");
      const overlay = document.getElementById("overlay");
      const contentArea = document.getElementById("contentArea");
      const links = document.querySelectorAll(".nav-item a");

      // Open sidebar
      toggleBtn.addEventListener("click", () => {
        sidebar.classList.add("active");
        overlay.classList.add("active");
      });

      // Close sidebar
      closeBtn.addEventListener("click", () => {
        sidebar.classList.remove("active");
        overlay.classList.remove("active");
      });

      // Click overlay to close sidebar
      overlay.addEventListener("click", () => {
        sidebar.classList.remove("active");
        overlay.classList.remove("active");
      });

      function executeScripts(container) {
        const scripts = container.querySelectorAll("script");

        scripts.forEach(oldScript => {
          // For inline scripts, execute with eval in a fresh context
          if (!oldScript.src) {
            // Use eval to execute script in fresh context every time
            try {
              eval(oldScript.innerHTML);
            } catch (e) {
              console.error("Script execution error:", e);
            }
          } else {
            // For external scripts, create new script element
            const newScript = document.createElement("script");
            newScript.src = oldScript.src;
            newScript.async = false;
            document.body.appendChild(newScript);
          }
          
          // Remove old script reference
          oldScript.remove();
        });
      }

      // Load page dynamically
      function loadPage(pageName, pushState = true) {
        // Add cache-busting timestamp
        const timestamp = new Date().getTime();
        fetch(`pages/${pageName}.html?t=${timestamp}`)
          .then(res => res.ok ? res.text() : Promise.reject("Page not found"))
          .then(html => {
            // Clear previous content completely
            contentArea.innerHTML = "";
            
            // Add new content
            contentArea.innerHTML = html;
            
            // Execute scripts IMMEDIATELY - this is crucial
            executeScripts(contentArea);
            
            // Update active link - query fresh links from sidebar
            const allLinks = document.querySelectorAll(".nav-item a");
            allLinks.forEach(l => l.classList.remove("active"));
            const activeLink = document.querySelector(`[data-page="${pageName}"]`);
            if (activeLink) activeLink.classList.add("active");

            // Update URL hash
            if (pushState) {
              history.pushState({ page: pageName }, "", `#${pageName}`);
            }

            // Close sidebar on mobile
            sidebar.classList.remove("active");
            overlay.classList.remove("active");

            // Re-attach toggle button functionality for loaded content
            attachToggleButton();
            
            // Re-attach navigation after page loads
            attachNavigation();
          })
          .catch(err => {
            contentArea.innerHTML = "<h2>Page Not Found</h2><p>Error: " + err + "</p>";
            console.error(err);
          });
      }

      // Attach toggle button event listeners
      function attachToggleButton() {
        // Find toggle buttons in loaded content
        const toggleBtns = contentArea.querySelectorAll(".toggle-btn");
        toggleBtns.forEach(btn => {
          btn.addEventListener("click", () => {
            sidebar.classList.add("active");
            overlay.classList.add("active");
          });
        });

        // Find close buttons in loaded content
        const closeBtns = contentArea.querySelectorAll(".close-btn");
        closeBtns.forEach(btn => {
          btn.addEventListener("click", () => {
            sidebar.classList.remove("active");
            overlay.classList.remove("active");
          });
        });
      }

      // Sidebar navigation clicks
      function attachNavigation() {
        // Query fresh links from sidebar each time
        const currentLinks = document.querySelectorAll(".nav-item a");
        currentLinks.forEach(link => {
          // Clone and replace to remove old event listeners
          const newLink = link.cloneNode(true);
          link.parentNode.replaceChild(newLink, link);
          
          // Add fresh event listener
          newLink.addEventListener("click", e => {
            e.preventDefault();
            const page = newLink.getAttribute("data-page");
            loadPage(page);
          });
        });
      }

      // Attach navigation on page load
      attachNavigation();

      // Handle browser back/forward
      window.addEventListener("popstate", e => {
        const page = e.state?.page || "Dashboard";
        loadPage(page, false);
      });

      // Load initial page based on URL hash
      const initialPage = location.hash.replace("#", "") || "Dashboard";
      loadPage(initialPage, false);
    });
  </script>
  
</body>
</html>
